from flask import Flask, request, jsonify
import requests
import json
app = Flask(__name__)
import datetime

api_key = 'FTSNQ16Zr6bjMxZGVQIiwSmhHgzpmZAF'
# api_key = 'kiJKS7r7r7c3YTbhP7OReSjmNeS7ZSf1'

@app.route('/')
def root():
    return app.send_static_file('weather.html')

@app.route('/search_curr_weather')
def search_curr_weather():
    latlon = request.args.get('location')
    result = {}
    try:
        url = 'https://api.tomorrow.io/v4/timelines?location='+latlon+'&fields=temperature,temperatureApparent,temperatureMin,temperatureMax,windSpeed,windDirection,humidity,pressureSeaLevel,uvIndex,weatherCode,precipitationProbability,precipitationType,visibility,cloudCover&timesteps=current&units=imperial&timezone=America/Los_Angeles&apikey='+api_key
        curr_results = requests.get(url)
        response = curr_results.json()
        result = response['data']['timelines'][0]['intervals'][0]['values']
    except:
        print('Exception while parsing')
        # result = {"cloudCover":38,"humidity":68,"precipitationProbability":0,"precipitationType":0,"pressureSeaLevel":30.11,"temperature":53.94,"temperatureApparent":53.94,"temperatureMax":53.94,"temperatureMin":53.94,"uvIndex":0,"visibility":9.94,"weatherCode":1101,"windDirection":159.19,"windSpeed":7.4}
    return jsonify(result)

@app.route('/search_intervals_weather')
def search_intervals_weather():
    result = []
    latlon = request.args.get('location')
    try:
        url1 = 'https://api.tomorrow.io/v4/timelines?location='+latlon+'&fields=temperature,temperatureApparent,temperatureMin,temperatureMax,windSpeed,windDirection,humidity,pressureSeaLevel,uvIndex,weatherCode,precipitationProbability,precipitationType,visibility,cloudCover,sunriseTime,sunsetTime&timesteps=1d&units=imperial&timezone=America/Los_Angeles&apikey='+api_key
        table_results = requests.get(url1)
        response = table_results.json()
        result = response['data']['timelines'][0]['intervals']
    except:
        # result = [{"startTime":"2021-10-02T06:00:00-07:00","values":{"cloudCover":100,"humidity":95,"precipitationProbability":0,"precipitationType":0,"pressureSeaLevel":30.08,"sunriseTime":"2021-10-02T07:08:20-07:00","sunsetTime":"2021-10-02T18:46:40-07:00","temperature":63.5,"temperatureApparent":63.5,"temperatureMax":63.5,"temperatureMin":49.44,"uvIndex":2,"visibility":9.94,"weatherCode":1001,"windDirection":184.3,"windSpeed":8.99}},{"startTime":"2021-10-03T06:00:00-07:00","values":{"cloudCover":100,"humidity":86.08,"precipitationProbability":0,"precipitationType":1,"pressureSeaLevel":30.02,"sunriseTime":"2021-10-03T07:11:40-07:00","sunsetTime":"2021-10-03T18:45:00-07:00","temperature":55.22,"temperatureApparent":55.22,"temperatureMax":55.22,"temperatureMin":50.67,"uvIndex":1,"visibility":9.94,"weatherCode":1001,"windDirection":155.07,"windSpeed":7.85}},{"startTime":"2021-10-04T06:00:00-07:00","values":{"cloudCover":100,"humidity":78.39,"precipitationProbability":0,"precipitationType":1,"pressureSeaLevel":29.89,"sunriseTime":"2021-10-04T07:13:20-07:00","sunsetTime":"2021-10-04T18:41:40-07:00","temperature":56.53,"temperatureApparent":56.53,"temperatureMax":56.53,"temperatureMin":50.36,"uvIndex":2,"visibility":9.94,"weatherCode":1001,"windDirection":66.45,"windSpeed":8.72}},{"startTime":"2021-10-05T06:00:00-07:00","values":{"cloudCover":100,"humidity":93.27,"precipitationProbability":65,"precipitationType":1,"pressureSeaLevel":29.9,"sunriseTime":"2021-10-05T07:13:20-07:00","sunsetTime":"2021-10-05T18:40:00-07:00","temperature":52.52,"temperatureApparent":52.52,"temperatureMax":52.52,"temperatureMin":46.18,"uvIndex":0,"visibility":14.16,"weatherCode":4000,"windDirection":162.55,"windSpeed":12.3}},{"startTime":"2021-10-06T06:00:00-07:00","values":{"cloudCover":75.75,"humidity":94.24,"precipitationProbability":25,"precipitationType":1,"pressureSeaLevel":30.03,"sunriseTime":"2021-10-06T07:15:00-07:00","sunsetTime":"2021-10-06T18:38:20-07:00","temperature":59,"temperatureApparent":59,"temperatureMax":59,"temperatureMin":42.15,"uvIndex":2,"visibility":15,"weatherCode":4000,"windDirection":216,"windSpeed":8.7}},{"startTime":"2021-10-07T06:00:00-07:00","values":{"cloudCover":27.85,"humidity":95.17,"precipitationProbability":0,"precipitationType":0,"pressureSeaLevel":29.91,"sunriseTime":"2021-10-07T07:18:20-07:00","sunsetTime":"2021-10-07T18:36:40-07:00","temperature":58.3,"temperatureApparent":58.3,"temperatureMax":58.3,"temperatureMin":41.14,"visibility":15,"weatherCode":1100,"windDirection":121.35,"windSpeed":7.2}},{"startTime":"2021-10-08T06:00:00-07:00","values":{"cloudCover":22.63,"humidity":86.5,"precipitationProbability":0,"precipitationType":0,"pressureSeaLevel":29.97,"sunriseTime":"2021-10-08T07:18:20-07:00","sunsetTime":"2021-10-08T18:33:20-07:00","temperature":59.94,"temperatureApparent":59.94,"temperatureMax":59.94,"temperatureMin":41.32,"visibility":15,"weatherCode":1100,"windDirection":158.59,"windSpeed":3.78}},{"startTime":"2021-10-09T06:00:00-07:00","values":{"cloudCover":99.89,"humidity":80,"precipitationProbability":0,"precipitationType":1,"pressureSeaLevel":30.13,"sunriseTime":"2021-10-09T07:20:00-07:00","sunsetTime":"2021-10-09T18:31:40-07:00","temperature":62.01,"temperatureApparent":62.01,"temperatureMax":62.01,"temperatureMin":42.98,"visibility":15,"weatherCode":1001,"windDirection":127.81,"windSpeed":4.07}},{"startTime":"2021-10-10T06:00:00-07:00","values":{"cloudCover":100,"humidity":95.06,"precipitationProbability":60,"precipitationType":1,"pressureSeaLevel":30.05,"sunriseTime":"2021-10-10T07:21:40-07:00","sunsetTime":"2021-10-10T18:31:40-07:00","temperature":51.33,"temperatureApparent":51.33,"temperatureMax":51.33,"temperatureMin":45.28,"visibility":15,"weatherCode":4200,"windDirection":157.1,"windSpeed":8.28}},{"startTime":"2021-10-11T06:00:00-07:00","values":{"cloudCover":100,"humidity":93.67,"precipitationProbability":0,"precipitationType":1,"pressureSeaLevel":30.14,"sunriseTime":"2021-10-11T07:21:40-07:00","sunsetTime":"2021-10-11T18:30:00-07:00","temperature":56.01,"temperatureApparent":56.01,"temperatureMax":56.01,"temperatureMin":40.33,"visibility":15,"weatherCode":1001,"windDirection":137.28,"windSpeed":8.01}},{"startTime":"2021-10-12T06:00:00-07:00","values":{"cloudCover":100,"humidity":91.57,"precipitationProbability":50,"precipitationType":1,"pressureSeaLevel":29.81,"sunriseTime":"2021-10-12T07:23:20-07:00","sunsetTime":"2021-10-12T18:26:40-07:00","temperature":54.27,"temperatureApparent":54.27,"temperatureMax":54.27,"temperatureMin":40.26,"visibility":15,"weatherCode":4200,"windDirection":190.11,"windSpeed":5.95}},{"startTime":"2021-10-13T06:00:00-07:00","values":{"cloudCover":100,"humidity":92.04,"precipitationProbability":75,"precipitationType":1,"pressureSeaLevel":29.54,"sunriseTime":"2021-10-13T07:26:40-07:00","sunsetTime":"2021-10-13T18:25:00-07:00","temperature":53.64,"temperatureApparent":53.64,"temperatureMax":53.64,"temperatureMin":45.79,"visibility":15,"weatherCode":4000,"windDirection":175.05,"windSpeed":9.55}},{"startTime":"2021-10-14T06:00:00-07:00","values":{"cloudCover":100,"humidity":95.46,"precipitationProbability":95,"precipitationType":1,"pressureSeaLevel":29.49,"sunriseTime":"2021-10-14T07:26:40-07:00","sunsetTime":"2021-10-14T18:23:20-07:00","temperature":57.18,"temperatureApparent":57.18,"temperatureMax":57.18,"temperatureMin":46.56,"visibility":15,"weatherCode":4000,"windDirection":177.72,"windSpeed":13.89}},{"startTime":"2021-10-15T06:00:00-07:00","values":{"cloudCover":99.75,"humidity":95.81,"precipitationProbability":45,"precipitationType":1,"pressureSeaLevel":29.52,"sunriseTime":"2021-10-15T07:28:20-07:00","sunsetTime":"2021-10-15T18:21:40-07:00","temperature":53.91,"temperatureApparent":53.91,"temperatureMax":53.91,"temperatureMin":45.81,"visibility":15,"weatherCode":4000,"windDirection":168.89,"windSpeed":4.7}},{"startTime":"2021-10-16T06:00:00-07:00","values":{"cloudCover":100,"humidity":94.98,"precipitationProbability":40,"precipitationType":1,"pressureSeaLevel":30.04,"sunriseTime":"2021-10-16T07:30:00-07:00","sunsetTime":"2021-10-16T18:18:20-07:00","temperature":54.9,"temperatureApparent":54.9,"temperatureMax":54.9,"temperatureMin":43.45,"visibility":15,"weatherCode":4000,"windDirection":190.22,"windSpeed":9.44}},{"startTime":"2021-10-17T06:00:00-07:00","values":{"cloudCover":100,"humidity":85.84,"precipitationProbability":65,"precipitationType":1,"pressureSeaLevel":29.9,"sunriseTime":"2021-10-17T07:30:00-07:00","sunsetTime":"2021-10-17T18:16:40-07:00","temperature":56.39,"temperatureApparent":56.39,"temperatureMax":56.39,"temperatureMin":49.95,"visibility":15,"weatherCode":4000,"windDirection":193.03,"windSpeed":17.07}}]
        print('Exception while parsing')
    return jsonify(result)


@app.route('/get_next_five_days')
def get_next_five_days():
    result = []
    latlon = request.args.get('location')
    try:
        url1 = 'https://api.tomorrow.io/v4/timelines?location='+latlon+'&fields=temperature,windSpeed,windDirection,humidity,pressureSeaLevel&timesteps=1h&units=imperial&timezone=America/Los_Angeles&apikey='+api_key
        table_results = requests.get(url1)
        response = table_results.json()
        result = response['data']['timelines'][0]['intervals']
    except:
        # result = [{"startTime":"2021-10-02T06:00:00-07:00","values":{"cloudCover":100,"humidity":95,"precipitationProbability":0,"precipitationType":0,"pressureSeaLevel":30.08,"sunriseTime":"2021-10-02T07:08:20-07:00","sunsetTime":"2021-10-02T18:46:40-07:00","temperature":63.5,"temperatureApparent":63.5,"temperatureMax":63.5,"temperatureMin":49.44,"uvIndex":2,"visibility":9.94,"weatherCode":1001,"windDirection":184.3,"windSpeed":8.99}},{"startTime":"2021-10-03T06:00:00-07:00","values":{"cloudCover":100,"humidity":86.08,"precipitationProbability":0,"precipitationType":1,"pressureSeaLevel":30.02,"sunriseTime":"2021-10-03T07:11:40-07:00","sunsetTime":"2021-10-03T18:45:00-07:00","temperature":55.22,"temperatureApparent":55.22,"temperatureMax":55.22,"temperatureMin":50.67,"uvIndex":1,"visibility":9.94,"weatherCode":1001,"windDirection":155.07,"windSpeed":7.85}},{"startTime":"2021-10-04T06:00:00-07:00","values":{"cloudCover":100,"humidity":78.39,"precipitationProbability":0,"precipitationType":1,"pressureSeaLevel":29.89,"sunriseTime":"2021-10-04T07:13:20-07:00","sunsetTime":"2021-10-04T18:41:40-07:00","temperature":56.53,"temperatureApparent":56.53,"temperatureMax":56.53,"temperatureMin":50.36,"uvIndex":2,"visibility":9.94,"weatherCode":1001,"windDirection":66.45,"windSpeed":8.72}},{"startTime":"2021-10-05T06:00:00-07:00","values":{"cloudCover":100,"humidity":93.27,"precipitationProbability":65,"precipitationType":1,"pressureSeaLevel":29.9,"sunriseTime":"2021-10-05T07:13:20-07:00","sunsetTime":"2021-10-05T18:40:00-07:00","temperature":52.52,"temperatureApparent":52.52,"temperatureMax":52.52,"temperatureMin":46.18,"uvIndex":0,"visibility":14.16,"weatherCode":4000,"windDirection":162.55,"windSpeed":12.3}},{"startTime":"2021-10-06T06:00:00-07:00","values":{"cloudCover":75.75,"humidity":94.24,"precipitationProbability":25,"precipitationType":1,"pressureSeaLevel":30.03,"sunriseTime":"2021-10-06T07:15:00-07:00","sunsetTime":"2021-10-06T18:38:20-07:00","temperature":59,"temperatureApparent":59,"temperatureMax":59,"temperatureMin":42.15,"uvIndex":2,"visibility":15,"weatherCode":4000,"windDirection":216,"windSpeed":8.7}},{"startTime":"2021-10-07T06:00:00-07:00","values":{"cloudCover":27.85,"humidity":95.17,"precipitationProbability":0,"precipitationType":0,"pressureSeaLevel":29.91,"sunriseTime":"2021-10-07T07:18:20-07:00","sunsetTime":"2021-10-07T18:36:40-07:00","temperature":58.3,"temperatureApparent":58.3,"temperatureMax":58.3,"temperatureMin":41.14,"visibility":15,"weatherCode":1100,"windDirection":121.35,"windSpeed":7.2}},{"startTime":"2021-10-08T06:00:00-07:00","values":{"cloudCover":22.63,"humidity":86.5,"precipitationProbability":0,"precipitationType":0,"pressureSeaLevel":29.97,"sunriseTime":"2021-10-08T07:18:20-07:00","sunsetTime":"2021-10-08T18:33:20-07:00","temperature":59.94,"temperatureApparent":59.94,"temperatureMax":59.94,"temperatureMin":41.32,"visibility":15,"weatherCode":1100,"windDirection":158.59,"windSpeed":3.78}},{"startTime":"2021-10-09T06:00:00-07:00","values":{"cloudCover":99.89,"humidity":80,"precipitationProbability":0,"precipitationType":1,"pressureSeaLevel":30.13,"sunriseTime":"2021-10-09T07:20:00-07:00","sunsetTime":"2021-10-09T18:31:40-07:00","temperature":62.01,"temperatureApparent":62.01,"temperatureMax":62.01,"temperatureMin":42.98,"visibility":15,"weatherCode":1001,"windDirection":127.81,"windSpeed":4.07}},{"startTime":"2021-10-10T06:00:00-07:00","values":{"cloudCover":100,"humidity":95.06,"precipitationProbability":60,"precipitationType":1,"pressureSeaLevel":30.05,"sunriseTime":"2021-10-10T07:21:40-07:00","sunsetTime":"2021-10-10T18:31:40-07:00","temperature":51.33,"temperatureApparent":51.33,"temperatureMax":51.33,"temperatureMin":45.28,"visibility":15,"weatherCode":4200,"windDirection":157.1,"windSpeed":8.28}},{"startTime":"2021-10-11T06:00:00-07:00","values":{"cloudCover":100,"humidity":93.67,"precipitationProbability":0,"precipitationType":1,"pressureSeaLevel":30.14,"sunriseTime":"2021-10-11T07:21:40-07:00","sunsetTime":"2021-10-11T18:30:00-07:00","temperature":56.01,"temperatureApparent":56.01,"temperatureMax":56.01,"temperatureMin":40.33,"visibility":15,"weatherCode":1001,"windDirection":137.28,"windSpeed":8.01}},{"startTime":"2021-10-12T06:00:00-07:00","values":{"cloudCover":100,"humidity":91.57,"precipitationProbability":50,"precipitationType":1,"pressureSeaLevel":29.81,"sunriseTime":"2021-10-12T07:23:20-07:00","sunsetTime":"2021-10-12T18:26:40-07:00","temperature":54.27,"temperatureApparent":54.27,"temperatureMax":54.27,"temperatureMin":40.26,"visibility":15,"weatherCode":4200,"windDirection":190.11,"windSpeed":5.95}},{"startTime":"2021-10-13T06:00:00-07:00","values":{"cloudCover":100,"humidity":92.04,"precipitationProbability":75,"precipitationType":1,"pressureSeaLevel":29.54,"sunriseTime":"2021-10-13T07:26:40-07:00","sunsetTime":"2021-10-13T18:25:00-07:00","temperature":53.64,"temperatureApparent":53.64,"temperatureMax":53.64,"temperatureMin":45.79,"visibility":15,"weatherCode":4000,"windDirection":175.05,"windSpeed":9.55}},{"startTime":"2021-10-14T06:00:00-07:00","values":{"cloudCover":100,"humidity":95.46,"precipitationProbability":95,"precipitationType":1,"pressureSeaLevel":29.49,"sunriseTime":"2021-10-14T07:26:40-07:00","sunsetTime":"2021-10-14T18:23:20-07:00","temperature":57.18,"temperatureApparent":57.18,"temperatureMax":57.18,"temperatureMin":46.56,"visibility":15,"weatherCode":4000,"windDirection":177.72,"windSpeed":13.89}},{"startTime":"2021-10-15T06:00:00-07:00","values":{"cloudCover":99.75,"humidity":95.81,"precipitationProbability":45,"precipitationType":1,"pressureSeaLevel":29.52,"sunriseTime":"2021-10-15T07:28:20-07:00","sunsetTime":"2021-10-15T18:21:40-07:00","temperature":53.91,"temperatureApparent":53.91,"temperatureMax":53.91,"temperatureMin":45.81,"visibility":15,"weatherCode":4000,"windDirection":168.89,"windSpeed":4.7}},{"startTime":"2021-10-16T06:00:00-07:00","values":{"cloudCover":100,"humidity":94.98,"precipitationProbability":40,"precipitationType":1,"pressureSeaLevel":30.04,"sunriseTime":"2021-10-16T07:30:00-07:00","sunsetTime":"2021-10-16T18:18:20-07:00","temperature":54.9,"temperatureApparent":54.9,"temperatureMax":54.9,"temperatureMin":43.45,"visibility":15,"weatherCode":4000,"windDirection":190.22,"windSpeed":9.44}},{"startTime":"2021-10-17T06:00:00-07:00","values":{"cloudCover":100,"humidity":85.84,"precipitationProbability":65,"precipitationType":1,"pressureSeaLevel":29.9,"sunriseTime":"2021-10-17T07:30:00-07:00","sunsetTime":"2021-10-17T18:16:40-07:00","temperature":56.39,"temperatureApparent":56.39,"temperatureMax":56.39,"temperatureMin":49.95,"visibility":15,"weatherCode":4000,"windDirection":193.03,"windSpeed":17.07}}]
        print('Exception while parsing five day data')
    return jsonify(result)

if __name__ == '__main__':
    app.run(host='localhost', port=5000)